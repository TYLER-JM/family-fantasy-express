// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  previewFeatures = ["fieldReference"] // this is required in order to compare two columns in the same table
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Team {
  id Int @id @default(autoincrement())
  name String @db.VarChar(255)
  homeGames Event[] @relation("homeGames")
  awayGames Event[] @relation("awayGames")
  ownerTeamHistory OwnerTeamHistory[]
  predictions Prediction[]
}

model Owner {
  id         Int       @id @default(autoincrement())
  name      String   @db.VarChar(255)
  ownerTeamHistory OwnerTeamHistory[]   
  predictions Prediction[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model OwnerTeamHistory {
  id Int @id @default(autoincrement())
  owner Owner @relation(fields: [ownerId], references: [id])
  ownerId Int
  team Team @relation(fields: [teamId], references: [id])
  teamId Int
  startDate DateTime @default(now())
  endDate DateTime?
}

model Event {
  id Int @id @default(autoincrement()) // this is temporary, eventually game IDS come from NHL API
  scheduledDate DateTime
  eventStateId Int
  state EventState @relation(fields: [eventStateId], references: [id])
  homeTeam Team @relation("homeGames", fields: [homeTeamId], references: [id])
  homeTeamId Int
  homeTeamScore Int?
  awayTeam Team @relation("awayGames", fields: [awayTeamId], references: [id])
  awayTeamId Int
  awayTeamScore Int?
  overtime Boolean? @default(false)
  predictions Prediction[]
}

model EventState {
  id Int @id @default(autoincrement())
  name String @db.VarChar(255)
  events Event[]
}

model Prediction {
  id Int @id @default(autoincrement())
  ownerId Int
  owner Owner @relation(fields: [ownerId], references: [id])
  teamId Int
  team Team @relation(fields: [teamId], references: [id])
  eventId Int
  event Event @relation(fields: [eventId], references: [id])
  winPrediction Boolean
  winOutcome Boolean?
}